<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>HTML Viewer</title>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/lz-string@1.5.0/libs/lz-string.min.js"></script>

    <style>
      :root {
        --bg: #0b1220;
        --surface: rgba(255, 255, 255, 0.06);
        --surface-2: rgba(255, 255, 255, 0.08);
        --text: rgba(255, 255, 255, 0.92);
        --muted: rgba(255, 255, 255, 0.7);
        --border: rgba(255, 255, 255, 0.12);
        --accent: #7c3aed;
        --accent-2: #22c55e;
        --danger: #ef4444;
        --shadow: 0 12px 28px rgba(0, 0, 0, 0.35);
        --radius: 14px;
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        scroll-behavior: smooth;
      }

      body {
        font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
        background: radial-gradient(1200px 600px at 20% 10%, rgba(124, 58, 237, 0.25), transparent 60%), radial-gradient(900px 500px at 90% 0%, rgba(34, 197, 94, 0.18), transparent 55%),
          radial-gradient(1100px 700px at 50% 110%, rgba(59, 130, 246, 0.12), transparent 60%), var(--bg);
        color: var(--text);
        line-height: 1.55;
        min-height: 100vh;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 18px;
      }

      .card {
        background: linear-gradient(180deg, var(--surface), rgba(255, 255, 255, 0.03));
        border: 1px solid var(--border);
        border-radius: var(--radius);
        box-shadow: var(--shadow);
      }

      .builder {
        padding: 16px;
        display: grid;
        gap: 12px;
      }

      .builder textarea {
        width: 100%;
        min-height: 180px;
        resize: vertical;
        padding: 12px 12px;
        border-radius: 12px;
        border: 1px solid var(--border);
        background: rgba(0, 0, 0, 0.25);
        color: var(--text);
        outline: none;
      }

      .builder textarea:focus {
        border-color: rgba(124, 58, 237, 0.6);
        box-shadow: 0 0 0 4px rgba(124, 58, 237, 0.12);
      }

      .row {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        align-items: center;
      }

      .btn {
        appearance: none;
        border: 1px solid var(--border);
        background: rgba(255, 255, 255, 0.06);
        color: var(--text);
        padding: 10px 12px;
        border-radius: 12px;
        cursor: pointer;
        font-weight: 600;
        transition: transform 0.12s ease, background 0.2s ease, border-color 0.2s ease;
      }

      .btn:hover {
        transform: translateY(-1px);
        background: rgba(255, 255, 255, 0.1);
        border-color: rgba(255, 255, 255, 0.18);
      }

      .btn.primary {
        background: linear-gradient(135deg, rgba(124, 58, 237, 0.95), rgba(124, 58, 237, 0.6));
        border-color: rgba(124, 58, 237, 0.55);
      }

      .btn.primary:hover {
        background: linear-gradient(135deg, rgba(124, 58, 237, 1), rgba(124, 58, 237, 0.7));
      }

      .btn.good {
        background: linear-gradient(135deg, rgba(34, 197, 94, 0.95), rgba(34, 197, 94, 0.55));
        border-color: rgba(34, 197, 94, 0.55);
      }

      .btn.danger {
        background: rgba(239, 68, 68, 0.12);
        border-color: rgba(239, 68, 68, 0.45);
      }

      .field {
        width: 100%;
        display: grid;
        gap: 8px;
      }

      .field input {
        width: 100%;
        padding: 10px 12px;
        border-radius: 12px;
        border: 1px solid var(--border);
        background: rgba(0, 0, 0, 0.25);
        color: var(--text);
        outline: none;
      }

      .hint {
        font-size: 0.92rem;
        color: var(--muted);
      }

      .error {
        border: 1px solid rgba(239, 68, 68, 0.45);
        background: rgba(239, 68, 68, 0.12);
        color: rgba(255, 255, 255, 0.92);
        padding: 10px 12px;
        border-radius: 12px;
      }

      .toolbar {
        position: sticky;
        top: 0;
        z-index: 50;
        padding: 10px 0;
        backdrop-filter: blur(10px);
        background: linear-gradient(180deg, rgba(11, 18, 32, 0.92), rgba(11, 18, 32, 0.65));
        border-bottom: 1px solid rgba(255, 255, 255, 0.06);
      }

      .nav {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        align-items: center;
      }

      .chip {
        border: 1px solid var(--border);
        background: rgba(255, 255, 255, 0.06);
        color: var(--text);
        padding: 9px 12px;
        border-radius: 999px;
        cursor: pointer;
        font-weight: 600;
        transition: transform 0.12s ease, background 0.2s ease;
        user-select: none;
      }

      .chip:hover {
        transform: translateY(-1px);
        background: rgba(255, 255, 255, 0.1);
      }

      .chip.hidden {
        display: none;
      }

      .sections {
        padding-top: 12px;
        display: grid;
        gap: 16px;
      }

      .section {
        background: linear-gradient(180deg, var(--surface), rgba(255, 255, 255, 0.03));
        border: 1px solid var(--border);
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        padding: 14px;
        scroll-margin-top: 90px;
      }

      .section.hidden {
        display: none;
      }

      .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
      }

      .media-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
        gap: 14px;
        align-items: start;
      }

      .media-item {
        width: 100%;
        max-width: 100%;
        background: rgba(255, 255, 255, 0.06);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 14px;
        overflow: hidden;
        box-shadow: 0 10px 18px rgba(0, 0, 0, 0.22);
        transition: transform 0.18s ease, box-shadow 0.2s ease, border-color 0.2s ease;
        display: block;
      }

      .media-item a {
        display: block;
        width: 100%;
      }

      .media-item:hover {
        transform: translateY(-3px);
        border-color: rgba(124, 58, 237, 0.35);
        box-shadow: 0 14px 26px rgba(0, 0, 0, 0.3);
      }

      .media-item img,
      .media-item iframe,
      .media-item video {
        width: 100% !important;
        max-width: 100% !important;
        height: auto !important;
        display: block;
        object-fit: contain;
      }

      .media-item iframe {
        aspect-ratio: 16 / 9;
      }

      .media-item img,
      .media-item video {
        max-height: 85vh;
      }

      .links {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        justify-content: center;
      }

      .link-pill {
        padding: 10px 12px;
        border-radius: 999px;
        background: rgba(124, 58, 237, 0.18);
        border: 1px solid rgba(124, 58, 237, 0.35);
        color: var(--text);
        text-decoration: none;
        font-weight: 700;
        max-width: 100%;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      .link-pill:hover {
        background: rgba(124, 58, 237, 0.24);
      }

      #go-to-top {
        position: fixed;
        bottom: 18px;
        right: 18px;
        background: linear-gradient(135deg, rgba(124, 58, 237, 0.95), rgba(124, 58, 237, 0.55));
        color: white;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
        cursor: pointer;
        border: 1px solid rgba(124, 58, 237, 0.45);
        box-shadow: var(--shadow);
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.2s ease, transform 0.2s ease, visibility 0.2s ease;
        z-index: 100;
      }

      #go-to-top:hover {
        transform: translateY(-2px);
      }

      #go-to-top.visible {
        opacity: 1;
        visibility: visible;
      }

      #go-to-top svg {
        width: 24px;
        height: 24px;
        fill: white;
      }

      @media (max-width: 768px) {
        .container {
          padding: 12px;
        }

        .nav {
          overflow-x: auto;
          overflow-y: hidden;
          flex-wrap: nowrap;
          -webkit-overflow-scrolling: touch;
          padding-bottom: 6px;
        }

        .chip {
          flex: 0 0 auto;
          min-height: 44px;
        }

        .media-grid {
          grid-template-columns: 1fr;
        }

        .row {
          flex-direction: column;
          align-items: stretch;
          width: 100%;
        }

        .row .btn {
          width: 100%;
          min-height: 44px;
        }

        .links {
          flex-direction: column;
          align-items: stretch;
        }

        .link-pill {
          width: 100%;
          text-align: center;
        }
      }
    </style>
  </head>

  <body>
    <button id="go-to-top" title="Kembali ke Atas" aria-label="Kembali ke Atas">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
        <path d="M12 2L2 12h5v8h10v-8h5z" />
      </svg>
    </button>

    <div class="toolbar">
      <div class="container">
        <div id="section-navigation" class="nav">
          <button id="nav-images" class="chip hidden" data-target="images-section">Gambar</button>
          <button id="nav-videos" class="chip hidden" data-target="videos-section">Video</button>
          <button id="nav-iframes" class="chip hidden" data-target="iframes-section">Iframe</button>
          <button id="nav-links" class="chip hidden" data-target="links-section">Link</button>
          <button id="nav-reset" class="chip hidden" title="Kembali ke mode generator">Reset</button>
        </div>
      </div>
    </div>

    <div class="container">
      <div id="hash-error" class="error" style="display: none; margin-top: 12px"></div>

      <div id="builder" class="card builder" style="margin-top: 12px; display: none">
        <div class="hint">
          Tempel HTML (misalnya tag <code>&lt;a&gt;</code>, <code>&lt;img&gt;</code>, <code>&lt;video&gt;</code>, <code>&lt;iframe&gt;</code>). Nanti akan dibuat link dengan format <code>#h=...</code> yang lebih pendek daripada HTML mentah.
        </div>

        <textarea id="input-html" placeholder="Contoh: <a href='https://example.com' target='_blank'>Link</a>"></textarea>

        <div class="row">
          <button id="btn-generate" class="btn primary">Generate link</button>
          <button id="btn-clear" class="btn danger">Clear</button>
        </div>

        <div class="field" id="generated-field">
          <input id="generated-link" readonly placeholder="Link hasil generate akan muncul di sini" />
          <div class="row">
            <button id="btn-copy" class="btn good">Copy</button>
          </div>
          <div class="hint">Setelah generate, halaman akan otomatis pindah ke mode viewer karena hash berubah.</div>
        </div>
      </div>

      <div id="viewer" class="sections" style="display: none">
        <div id="images-section" class="section hidden">
          <h2 class="sr-only">Gambar</h2>
          <div id="images-grid" class="media-grid"></div>
        </div>

        <div id="videos-section" class="section hidden">
          <h2 class="sr-only">Video</h2>
          <div id="videos-grid" class="media-grid"></div>
        </div>

        <div id="iframes-section" class="section hidden">
          <h2 class="sr-only">Iframe</h2>
          <div id="iframes-grid" class="media-grid"></div>
        </div>

        <div id="links-section" class="section hidden">
          <h2 class="sr-only">Link</h2>
          <div id="links-container" class="links"></div>
        </div>
      </div>
    </div>

    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const builder = document.getElementById('builder');
        const viewer = document.getElementById('viewer');
        const hashError = document.getElementById('hash-error');

        const inputHtml = document.getElementById('input-html');
        const generatedLink = document.getElementById('generated-link');

        const nav = document.getElementById('section-navigation');
        const navReset = document.getElementById('nav-reset');

        const imagesGrid = document.getElementById('images-grid');
        const videosGrid = document.getElementById('videos-grid');
        const iframesGrid = document.getElementById('iframes-grid');
        const linksContainer = document.getElementById('links-container');

        const sections = {
          images: {
            grid: imagesGrid,
            container: document.getElementById('images-section'),
            navButton: document.getElementById('nav-images'),
            label: 'Gambar',
            count: 0,
          },
          videos: {
            grid: videosGrid,
            container: document.getElementById('videos-section'),
            navButton: document.getElementById('nav-videos'),
            label: 'Video',
            count: 0,
          },
          iframes: {
            grid: iframesGrid,
            container: document.getElementById('iframes-section'),
            navButton: document.getElementById('nav-iframes'),
            label: 'Iframe',
            count: 0,
          },
          links: {
            grid: linksContainer,
            container: document.getElementById('links-section'),
            navButton: document.getElementById('nav-links'),
            label: 'Link',
            count: 0,
          },
        };

        function resetUI() {
          hashError.style.display = 'none';
          hashError.textContent = '';

          Object.values(sections).forEach((s) => {
            s.grid.innerHTML = '';
            s.container.classList.add('hidden');
            s.navButton.classList.add('hidden');
            s.count = 0;
            s.navButton.textContent = s.label;
          });

          navReset.classList.add('hidden');
        }

        function setMode(mode) {
          if (mode === 'builder') {
            builder.style.display = 'grid';
            viewer.style.display = 'none';
          } else {
            builder.style.display = 'none';
            viewer.style.display = 'grid';
          }
        }

        function getPackedFromHash() {
          const raw = location.hash.startsWith('#') ? location.hash.slice(1) : location.hash;
          const params = new URLSearchParams(raw);
          const packed = params.get('h');
          return packed && packed.trim() ? packed.trim() : '';
        }

        function makeUrlWithPacked(packed) {
          const url = new URL(location.href);
          url.hash = 'h=' + packed;
          return url.toString();
        }

        function packHtml(html) {
          return LZString.compressToEncodedURIComponent(html || '');
        }

        function unpackHtml(packed) {
          const out = LZString.decompressFromEncodedURIComponent(packed || '');
          return out || '';
        }

        function showSection(key) {
          const s = sections[key];
          if (!s) return;

          if (s.count > 0) {
            s.container.classList.remove('hidden');
            s.navButton.classList.remove('hidden');
            s.navButton.textContent = s.label + ' (' + s.count + ')';
          }
        }

        function normalizeUrl(u) {
          try {
            return new URL(u, location.href).toString();
          } catch {
            return u;
          }
        }

        function addImage(imgEl, hrefOverride) {
          const mediaItem = document.createElement('div');
          mediaItem.className = 'media-item';

          const img = imgEl.cloneNode(true);
          img.setAttribute('loading', 'lazy');
          img.setAttribute('decoding', 'async');

          const a = document.createElement('a');
          const targetHref = hrefOverride || img.getAttribute('data-url') || img.src || '';
          a.href = normalizeUrl(targetHref);
          a.target = '_blank';
          a.rel = 'noopener noreferrer nofollow';
          a.appendChild(img);

          mediaItem.appendChild(a);

          sections.images.grid.appendChild(mediaItem);
          sections.images.count += 1;
        }

        function addVideo(videoEl) {
          const mediaItem = document.createElement('div');
          mediaItem.className = 'media-item';

          const video = videoEl.cloneNode(true);
          video.setAttribute('controls', '');
          video.setAttribute('preload', 'metadata');

          mediaItem.appendChild(video);

          sections.videos.grid.appendChild(mediaItem);
          sections.videos.count += 1;
        }

        function addIframe(iframeEl) {
          const mediaItem = document.createElement('div');
          mediaItem.className = 'media-item';

          const iframe = iframeEl.cloneNode(true);
          iframe.setAttribute('loading', 'lazy');

          if (!iframe.getAttribute('sandbox')) {
            iframe.setAttribute('sandbox', 'allow-scripts allow-popups allow-forms allow-presentation');
          }

          mediaItem.appendChild(iframe);

          sections.iframes.grid.appendChild(mediaItem);
          sections.iframes.count += 1;
        }

        function addLink(aEl) {
          const a = aEl.cloneNode(true);
          a.target = '_blank';
          a.rel = 'noopener noreferrer';

          const text = (a.textContent || a.href || 'Link').trim();
          a.textContent = text || 'Link';
          a.className = 'link-pill';

          sections.links.grid.appendChild(a);
          sections.links.count += 1;
        }

        function processAnchor(aEl) {
          const imgChild = aEl.querySelector('img');
          const videoChild = aEl.querySelector('video');
          const iframeChild = aEl.querySelector('iframe');

          if (imgChild) {
            addImage(imgChild, aEl.getAttribute('href') || '');
            return;
          }

          if (videoChild) {
            addVideo(videoChild);
            return;
          }

          if (iframeChild) {
            addIframe(iframeChild);
            return;
          }

          addLink(aEl);
        }

        function* walkRenderable(root) {
          const allowed = new Set(['A', 'IMG', 'VIDEO', 'IFRAME']);
          for (const child of Array.from(root.children)) {
            if (allowed.has(child.tagName)) {
              yield child;
              continue;
            }
            yield* walkRenderable(child);
          }
        }

        function renderHtmlToDOM(html) {
          resetUI();

          const parser = new DOMParser();
          const doc = parser.parseFromString(html || '', 'text/html');

          for (const el of walkRenderable(doc.body)) {
            const tag = el.tagName.toLowerCase();

            if (tag === 'img') addImage(el);
            else if (tag === 'video') addVideo(el);
            else if (tag === 'iframe') addIframe(el);
            else if (tag === 'a') processAnchor(el);
          }

          showSection('images');
          showSection('videos');
          showSection('iframes');
          showSection('links');

          const any = sections.images.count + sections.videos.count + sections.iframes.count + sections.links.count > 0;

          if (!any) {
            hashError.textContent = 'Konten tidak terbaca atau tidak ada elemen yang didukung.';
            hashError.style.display = 'block';
          }

          navReset.classList.remove('hidden');
        }

        function runByHash() {
          const packed = getPackedFromHash();

          if (!packed) {
            resetUI();
            setMode('builder');
            return;
          }

          setMode('viewer');

          const html = unpackHtml(packed);
          if (!html) {
            resetUI();
            hashError.textContent = 'Hash #h tidak valid atau gagal didekompres.';
            hashError.style.display = 'block';
            navReset.classList.remove('hidden');
            return;
          }

          renderHtmlToDOM(html);
        }

        nav.addEventListener('click', (e) => {
          const chip = e.target.closest('.chip');
          if (!chip) return;

          if (chip.id === 'nav-reset') {
            history.replaceState(null, '', location.pathname + location.search);
            runByHash();
            return;
          }

          const targetId = chip.getAttribute('data-target');
          if (!targetId) return;

          const el = document.getElementById(targetId);
          if (el) el.scrollIntoView({ behavior: 'smooth' });
        });

        document.getElementById('btn-generate').addEventListener('click', () => {
          const html = (inputHtml.value || '').trim();
          if (!html) {
            generatedLink.value = '';
            return;
          }

          const packed = packHtml(html);
          const url = makeUrlWithPacked(packed);
          generatedLink.value = url;

          location.hash = 'h=' + packed;
        });

        document.getElementById('btn-clear').addEventListener('click', () => {
          inputHtml.value = '';
          generatedLink.value = '';
        });

        document.getElementById('btn-copy').addEventListener('click', async () => {
          const v = generatedLink.value || '';
          if (!v) return;

          try {
            await navigator.clipboard.writeText(v);
          } catch {
            const tmp = document.createElement('textarea');
            tmp.value = v;
            document.body.appendChild(tmp);
            tmp.select();
            document.execCommand('copy');
            tmp.remove();
          }
        });

        const goToTopButton = document.getElementById('go-to-top');
        window.addEventListener('scroll', () => {
          if (window.scrollY > 320) goToTopButton.classList.add('visible');
          else goToTopButton.classList.remove('visible');
        });
        goToTopButton.addEventListener('click', () => window.scrollTo({ top: 0, behavior: 'smooth' }));

        runByHash();
        window.addEventListener('hashchange', runByHash);
      });
    </script>
  </body>
</html>
